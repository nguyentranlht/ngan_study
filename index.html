<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G·ª£i √Ω Ph∆∞∆°ng ti·ªán - T·ªëi ∆∞u Ph√°t th·∫£i CO2</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üå± G·ª£i √Ω Ph∆∞∆°ng ti·ªán Xanh</h1>
            <p>T√≠nh to√°n v√† so s√°nh l∆∞·ª£ng ph√°t th·∫£i CO2 ƒë·ªÉ ch·ªçn ph∆∞∆°ng ti·ªán t·ªëi ∆∞u</p>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label for="distance">üìç Kho·∫£ng c√°ch di chuy·ªÉn (km):</label>
                <input type="number" id="distance" placeholder="Nh·∫≠p kho·∫£ng c√°ch..." step="0.1" min="0">
                <label for="weight">Nh·∫≠p kh·ªëi l∆∞·ª£ng h√†ng h√≥a (t·∫•n):</label>
                <input type="number" id="weight" placeholder="Nh·∫≠p kh·ªëi l∆∞·ª£ng..." step="0.1" min="0">
            </div>
            <button class="calculate-btn" onclick="calculateEmissions()">
                üîç T√≠nh to√°n & G·ª£i √Ω
            </button>
        </div>

        <div class="results-section hidden" id="results">
            <h2 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">üìä K·∫øt qu·∫£ so s√°nh</h2>
            <div id="vehicleCards"></div>
            <div class="recommendation" id="recommendation"></div>
        </div>
    </div>

    <script>
        let vehicles = [];

        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                vehicles = data;
            })
            .catch(error => {
                alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu ph∆∞∆°ng ti·ªán!');
                console.error(error);
            });

        function calculateEmissions() {
            const distance = parseFloat(document.getElementById('distance').value);

            if (!distance || distance <= 0) {
                alert('Vui l√≤ng nh·∫≠p kho·∫£ng c√°ch h·ª£p l·ªá!');
                return;
            }
            const weight = parseFloat(document.getElementById('weight').value) || 0;
            if (weight < 0) {
                alert('Kh·ªëi l∆∞·ª£ng h√†ng h√≥a kh√¥ng th·ªÉ √¢m!');
                return;
            }
            // L·ªçc ph∆∞∆°ng ti·ªán ph√π h·ª£p v·ªõi kh·ªëi l∆∞·ª£ng h√†ng h√≥a
            const filteredVehicles = vehicles.filter(vehicle => weight <= vehicle.maxWeight);
            if (filteredVehicles.length === 0) {
                alert('Kh√¥ng c√≥ ph∆∞∆°ng ti·ªán ph√π h·ª£p v·ªõi kh·ªëi l∆∞·ª£ng h√†ng h√≥a ƒë√£ nh·∫≠p!');
                return;
            }

            const results = filteredVehicles.map(vehicle => ({
                ...vehicle,
                totalEmission: distance * vehicle.emissionFactor * (1 + (weight / vehicle.maxWeight)),
                fuelCost: distance * (vehicle.fuelConsumption / 100)
            }));

            // S·∫Øp x·∫øp theo l∆∞·ª£ng ph√°t th·∫£i t·ª´ th·∫•p ƒë·∫øn cao
            results.sort((a, b) => a.totalEmission - b.totalEmission);

            displayResults(results, distance);
        }

        function displayResults(results, distance) {
            const resultsSection = document.getElementById('results');
            const vehicleCards = document.getElementById('vehicleCards');
            const recommendation = document.getElementById('recommendation');

            vehicleCards.innerHTML = '';

            results.forEach((vehicle, index) => {
                const card = document.createElement('div');
                const cardClass = index === 0 ? 'best' : (index <= 2 ? 'good' : 'poor');

                card.className = `vehicle-card ${cardClass}`;
                card.innerHTML = `
                    <div class="vehicle-info">
                        <div class="vehicle-details">
                            <h3>
                                ${vehicle.name}
                                ${index === 0 ? '<span class="eco-badge">KHUY·∫æN NGH·ªä</span>' : ''}
                            </h3>
                            <p><strong>Lo·∫°i:</strong> ${vehicle.type}</p>
                            <p><strong>Nhi√™n li·ªáu:</strong> ${vehicle.fuelType}</p>
                            <p><strong>Ti√™u hao:</strong> ${vehicle.fuelConsumption} L/100km</p>
                            <p><strong>H·ªá s·ªë ph√°t th·∫£i:</strong> ${vehicle.emissionFactor} kg CO‚ÇÇ/km</p>
                        </div>
                        <div class="emission-info">
                            <div class="emission-value">${vehicle.totalEmission.toFixed(2)}</div>
                            <div class="emission-label">kg CO‚ÇÇ</div>
                        </div>
                    </div>
                `;
                vehicleCards.appendChild(card);
            });

            // G·ª£i √Ω
            const bestVehicle = results[0];
            const worstVehicle = results[results.length - 1];
            const savings = worstVehicle.totalEmission - bestVehicle.totalEmission;

            recommendation.innerHTML = `
                <h3>üí° Khuy·∫øn ngh·ªã</h3>
                <p><strong>${bestVehicle.name}</strong> l√† l·ª±a ch·ªçn t·ªët nh·∫•t cho qu√£ng ƒë∆∞·ªùng ${distance} km</p>
                <p>Ti·∫øt ki·ªám ƒë∆∞·ª£c <strong>${savings.toFixed(2)} kg CO‚ÇÇ</strong> so v·ªõi ph∆∞∆°ng ti·ªán k√©m hi·ªáu qu·∫£ nh·∫•t</p>
                ${bestVehicle.emissionFactor === 0 ?
                    '<p>üåø <strong>Xe ƒëi·ªán kh√¥ng ph√°t th·∫£i CO‚ÇÇ tr·ª±c ti·∫øp - L·ª±a ch·ªçn ho√†n h·∫£o cho m√¥i tr∆∞·ªùng!</strong></p>' :
                    '<p>üå± H√£y c√¢n nh·∫Øc chuy·ªÉn sang ph∆∞∆°ng ti·ªán th√¢n thi·ªán v·ªõi m√¥i tr∆∞·ªùng h∆°n</p>'
                }
            `;

            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Cho ph√©p t√≠nh to√°n khi nh·∫•n Enter
        document.getElementById('distance').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                calculateEmissions();
            }
        });
    </script>
</body>

</html>